export default class Zam{constructor(e){this.children=[],this.uniqueID=Zam.uniqueID,e||(e=""),this.origHTML=e;let t=document.createElement(this.constructor.name.toLowerCase());t.innerHTML=this._generateProperties(e),this.e=t.cloneNode(!0)}linkPropertyToNode(e){Zam.reverseProperties[e+"-"+this.uniqueID]||(Zam.reverseProperties[e+"-"+this.uniqueID]=[]),Zam.reverseProperties[e+"-"+this.uniqueID].push(this)}_generateBindings(e){if(e.origHTML.indexOf("z-bind=")>-1){let t=e.origHTML;if(t=(t=t.slice(t.indexOf('z-bind="')+8)).slice(0,t.indexOf('"')),void 0!==Zam.reverseProperties[t+"-"+e.uniqueID]){let i=Zam.reverseProperties[t+"-"+e.uniqueID].length;for(let r=0;r<i;r++)Zam.on("keyup",e.e.children[0],function(i){Zam.reverseProperties[t+"-"+e.uniqueID][r].prop(t,i.target.value)}.bind(e))}}let t=e.children.length;for(let i=0;i<t;i++)e._generateBindings(e.children[i])}searchForProperty(e,t){if(void 0!==e.properties[t])return e.properties[t];{let t=e.children.length;for(let i=0;i<t;i++)return this.searchForProperty(e.children[i])}return 0}_updateProperties(e){let t=e,i="";for(;t.indexOf("{{")>-1;){let e=t.slice(t.indexOf("{{")+2,t.indexOf("}}"));i+=t.slice(0,t.indexOf("{{"));let r=this.searchForProperty(this,e);r&&(i+=r),t=t.slice(t.indexOf("}}")+2)}return i+=t}_generateProperties(e){if(this.properties={},e.indexOf("{{")>-1&&e.indexOf("}}")>-1){let t=e,i="";for(this["properties-proxy"]={};t.indexOf("{{")>-1;){let e=t.slice(t.indexOf("{{")+2,t.indexOf("}}"));this["properties-proxy"][e]="",this.linkPropertyToNode(e),i+=t.slice(0,t.indexOf("{{")),t=t.slice(t.indexOf("}}")+2)}i+=t;let r=this,n={set(e,t,i){if(e[t]=i,void 0!==i){let e=Zam.reverseProperties[t+"-"+r.uniqueID].length;for(let i=0;i<e;i++){let e=Zam.reverseProperties[t+"-"+r.uniqueID][i];e.html=r._updateProperties(e.origHTML),e.e.innerHTML=r.html}r._generateBindings(r)}return!0}};return this.properties=new Proxy(this["properties-proxy"],n),i}return e}prop(e,t){return void 0!==t&&(this.properties[e]=t),this.properties[e]}static render(){let e=document.querySelectorAll(this.name.toLowerCase()),t=(e.length,[]);for(let i=0;i<e.length;i++)t.push(new this(...arguments)),e[i].replaceWith(t[i].e),t[i].e=document.querySelectorAll(this.name.toLowerCase())[i],t[i]._generateBindings(t[i]),Zam.uniqueID++;return t}static shadowRender(){let e=document.querySelectorAll(this.name.toLowerCase()),t=e.length,i=[];for(let r=0;r<t;r++){i.push(new this(...arguments));let t=document.createElement("div");t.attachShadow({mode:"open"}).appendChild(i[r].e),i[r]._generateBindings(i[r]),e[r].appendChild(t),Zam.uniqueID++}return i}render(e,t){t?document.querySelectorAll(e)[0].shadowRoot.querySelectorAll(t)[0].appendChild(this.e):document.querySelectorAll(e)[0].appendChild(this.e)}renderPrepend(e,t){if(t){let i=document.querySelectorAll(e)[0].shadowRoot.querySelectorAll(t)[0];i.insertBefore(this.e,i.firstChild)}else{let t=document.querySelectorAll(e)[0];t.insertBefore(this.e,t.firstChild)}}append(e,t){return e.key=t,e.parent=this,this[t]=e,this.e.appendChild(e.e),this.children.push(e),e}prepend(e,t){return e.key=t,e.parent=this,this[t]=e,this.e.insertBefore(e.e,this.e.firstChild),this.children.push(e),e}replace(e,t){return e.parent=this.parent,delete this.parent[this.key],this.parent[t]=e,this.e.replaceWith(e.e),e}remove(e){this.e.parentNode.removeChild(this.e),delete this.parent[this.key]}on(e,t){let i=function(e,t){this.e.children[0].addEventListener(e,t)}.bind(this);if(-1!==e.indexOf(" ")){let r=e;for(;-1!==r.indexOf(" ");)i(r.slice(0,r.indexOf(" ")),t),r=r.slice(r.indexOf(" ")+1);i(r,t)}else i(e,t);return this}static on(e,t,i){let r=function(e,t,i){if("string"==typeof t){let r=document.querySelectorAll(t),n=r.length;for(let t=0;t<n;t++)r[t].shadowRoot?r[t].shadowRoot.addEventListener(e,i):r[t].addEventListener(e,i)}else t.shadowRoot?t.shadowRoot.addEventListener(e,i):t.addEventListener(e,i)};if(-1!==e.indexOf(" ")){let n=e;for(;-1!==n.indexOf(" ");)r(n.slice(0,n.indexOf(" ")),t,i),n=n.slice(n.indexOf(" ")+1);r(n,t,i)}else r(e,t,i)}off(e,t){let i=function(e,t){this.e.removeEventListener(e,t)}.bind(this);if(-1!==e.indexOf(" ")){let r=e;for(;-1!==r.indexOf(" ");)i(r.slice(0,r.indexOf(" ")),t),r=r.slice(r.indexOf(" ")+1);i(r,t)}else i(e,t);return this}static off(e,t,r){let n=function(e,t,r){if("string"==typeof t){let i=document.querySelectorAll(t),n=i.length;for(let t=0;t<n;t++)i[t].shadowRoot?i[t].shadowRoot.removeEventListener(e,r):i[t].removeEventListener(e,r)}else t[i].shadowRoot?t[i].shadowRoot.removeEventListener(e,r):t[i].removeEventListener(e,r)};if(-1!==e.indexOf(" ")){let i=e;for(;-1!==i.indexOf(" ");)n(i.slice(0,i.indexOf(" ")),t,r),i=i.slice(i.indexOf(" ")+1);n(i,t,r)}else n(e,t,r)}customEvent(e){this[e]=new CustomEvent(e,{bubbles:!0,cancelable:!1})}dispatchEvent(e){this.e.dispatchEvent(this[e])}};Zam.uniqueID=0,Zam.reverseProperties={};