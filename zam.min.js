export default class Zam{constructor(e){this.children=[],this.uniqueID=Zam.uniqueID,e||(e=""),this.origHTML=e;var r=document.createElement(this.constructor.name.toLowerCase());r.innerHTML=this._generateProperties(e),this.e=r.cloneNode(!0)}linkPropertyToNode(e){Zam.reverseProperties[e+"-"+this.uniqueID]||(Zam.reverseProperties[e+"-"+this.uniqueID]=[]),Zam.reverseProperties[e+"-"+this.uniqueID].push(this)}_generateBindings(e){if(e.origHTML.indexOf("z-bind=")>-1){var r=e.origHTML;if(r=(r=r.slice(r.indexOf('z-bind="')+8)).slice(0,r.indexOf('"')),void 0!==Zam.reverseProperties[r+"-"+e.uniqueID])for(var t=Zam.reverseProperties[r+"-"+e.uniqueID].length,i=0;i<t;i++)Zam.on("keyup",e.e.children[0],function(t){Zam.reverseProperties[r+"-"+e.uniqueID][i].prop(r,t.target.value)}.bind(e))}for(t=e.children.length,i=0;i<t;i++)e._generateBindings(e.children[i])}searchForProperty(e,r){if(void 0!==e.properties[r])return e.properties[r];for(var t=e.children.length,i=0;i<t;i++)return this.searchForProperty(e.children[i]);return 0}_updateProperties(e){for(var r=e,t="";r.indexOf("{{")>-1;){var i=r.slice(r.indexOf("{{")+2,r.indexOf("}}"));t+=r.slice(0,r.indexOf("{{"));var n=this.searchForProperty(this,i);n&&(t+=n),r=r.slice(r.indexOf("}}")+2)}return t+=r}_generateProperties(e){if(this.properties={},e.indexOf("{{")>-1&&e.indexOf("}}")>-1){var r=e,t="";for(this["properties-proxy"]={};r.indexOf("{{")>-1;){var i=r.slice(r.indexOf("{{")+2,r.indexOf("}}"));this["properties-proxy"][i]="",this.linkPropertyToNode(i),t+=r.slice(0,r.indexOf("{{")),r=r.slice(r.indexOf("}}")+2)}t+=r;var n=this,s={set(e,r,t){if(e[r]=t,void 0!==t){for(var i=Zam.reverseProperties[r+"-"+n.uniqueID].length,s=0;s<i;s++){var o=Zam.reverseProperties[r+"-"+n.uniqueID][s];o.html=n._updateProperties(o.origHTML),o.e.innerHTML=n.html}n._generateBindings(n)}return!0}};return this.properties=new Proxy(this["properties-proxy"],s),t}return e}prop(e,r){return void 0!==r&&(this.properties[e]=r),this.properties[e]}static render(){for(var e=document.querySelectorAll(this.name.toLowerCase()),r=(e.length,[]),t=0;t<e.length;t++)r.push(new this(...arguments)),e[t].replaceWith(r[t].e),r[t].e=document.querySelectorAll(this.name.toLowerCase())[t],r[t]._generateBindings(r[t]),Zam.uniqueID++;return r}static shadowRender(){for(var e=document.querySelectorAll(this.name.toLowerCase()),r=e.length,t=[],i=0;i<r;i++){t.push(new this(...arguments));var n=document.createElement("div"),s=n.attachShadow({mode:"open"});s.appendChild(t[i].e),t[i]._generateBindings(t[i]),e[i].appendChild(n),Zam.uniqueID++}return t}render(e,r){r?document.querySelectorAll(e)[0].shadowRoot.querySelectorAll(r)[0].appendChild(this.e):document.querySelectorAll(e)[0].appendChild(this.e)}renderPrepend(e,r){if(r){(t=document.querySelectorAll(e)[0].shadowRoot.querySelectorAll(r)[0]).insertBefore(this.e,t.firstChild)}else{var t;(t=document.querySelectorAll(e)[0]).insertBefore(this.e,t.firstChild)}}append(e,r){return e.key=r,e.parent=this,this[r]=e,this.e.appendChild(e.e),this.children.push(e),e}prepend(e,r){return e.key=r,e.parent=this,this[r]=e,this.e.insertBefore(e.e,this.e.firstChild),this.children.push(e),e}replace(e,r){return e.parent=this.parent,delete this.parent[this.key],this.parent[r]=e,this.e.replaceWith(e.e),e}remove(e){this.e.parentNode.removeChild(this.e),delete this.parent[this.key]}on(e,r){var t=function(e,r){this.e.children[0].addEventListener(e,r)}.bind(this);if(-1!==e.indexOf(" ")){for(var i=e;-1!==i.indexOf(" ");)t(i.slice(0,i.indexOf(" ")),r),i=i.slice(i.indexOf(" ")+1);t(i,r)}else t(e,r);return this}static on(e,r,t){var i=function(e,r,t){if("string"==typeof r)for(var i=document.querySelectorAll(r),n=i.length,s=0;s<n;s++)i[s].shadowRoot?i[s].shadowRoot.addEventListener(e,t):i[s].addEventListener(e,t);else r.shadowRoot?r.shadowRoot.addEventListener(e,t):r.addEventListener(e,t)};if(-1!==e.indexOf(" ")){for(var n=e;-1!==n.indexOf(" ");)i(n.slice(0,n.indexOf(" ")),r,t),n=n.slice(n.indexOf(" ")+1);i(n,r,t)}else i(e,r,t)}off(e,r){var t=function(e,r){this.e.removeEventListener(e,r)}.bind(this);if(-1!==e.indexOf(" ")){for(var i=e;-1!==i.indexOf(" ");)t(i.slice(0,i.indexOf(" ")),r),i=i.slice(i.indexOf(" ")+1);t(i,r)}else t(e,r);return this}static off(e,r,t){var i=function(e,r,t){if("string"==typeof r)for(var i=document.querySelectorAll(r),n=i.length,s=0;s<n;s++)i[s].shadowRoot?i[s].shadowRoot.removeEventListener(e,t):i[s].removeEventListener(e,t);else r[s].shadowRoot?r[s].shadowRoot.removeEventListener(e,t):r[s].removeEventListener(e,t)};if(-1!==e.indexOf(" ")){for(var n=e;-1!==n.indexOf(" ");)i(n.slice(0,n.indexOf(" ")),r,t),n=n.slice(n.indexOf(" ")+1);i(n,r,t)}else i(e,r,t)}customEvent(e){this[e]=new CustomEvent(e,{bubbles:!0,cancelable:!1})}dispatchEvent(e){this.e.dispatchEvent(this[e])}};Zam.uniqueID=0,Zam.reverseProperties={};